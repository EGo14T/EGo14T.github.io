<!DOCTYPE html><html class="theme-next pisces" lang="zh-Hans"><head><link href="/css/main.css?v=21.04.26" rel="stylesheet" type="text/css"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#da532c"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//fonts.loli.net/css?family=Sigmar One:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=21.04.26"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=21.04.26"><link rel="mask-icon" href="/safari-pinned-tab.svg?v=21.04.26" color="#da532c"><link rel="manifest" href="/site.webmanifest"><meta name="keywords" content="ego1st,blog"><link rel="alternate" href="/atom.xml" title="Hi,EGo1ST!" type="application/atom+xml"><meta name="description" content="上一周把自己的博客搬到新买的腾讯云上了，为了节省部署的时间，所以我的博客使用了持续化部署，其中踩了许多坑，写个教程总结记录一下。"><meta property="og:type" content="article"><meta property="og:title" content="持续化部署你的blog"><meta property="og:url" content="https://ego1st.cn/TravisCIYourBlog/index.html"><meta property="og:site_name" content="Hi,EGo1ST!"><meta property="og:description" content="上一周把自己的博客搬到新买的腾讯云上了，为了节省部署的时间，所以我的博客使用了持续化部署，其中踩了许多坑，写个教程总结记录一下。"><meta property="og:locale"><meta property="og:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_16-33-13.jpg"><meta property="og:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-19-07.jpg"><meta property="og:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-22-28.jpg"><meta property="og:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-27-04.jpg"><meta property="og:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-31-40.jpg"><meta property="article:published_time" content="2019-08-13T15:36:06.000Z"><meta property="article:modified_time" content="2021-04-26T06:59:27.217Z"><meta property="article:author" content="EGo1ST"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_16-33-13.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"",scheme:"Pisces",version:"21.04.26",sidebar:{position:"right",display:"always",offset:52,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},since:"6/28/2019 19:30:00",onlineAPI:"",site:{title:"",subtitle:"",author:""},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},leancloud:{enable:!0,appID:"DMIBOS7zL7HSjBjzvYvr7eMY-gzGzoHsz",appKey:"14l8coYH4XyLm1hWQA6thMLo"},favicon:{visibilitychange:!0,narmal:"/favicon.ico",hidden:"/failure.ico",show_text:"(/≧▽≦/)咦！又好了！",hide_text:"(●—●)喔哟，崩溃啦！"}}</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="canonical" href="https://ego1st.cn/TravisCIYourBlog/"><title>持续化部署你的blog | Hi,EGo1ST!</title><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-145810187-1","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans" class="theme-darling"><div class="container sidebar-position-right page-post-detail"><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item scaleup menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item scaleup menu-item-抓到我"><a href="javascript:;" rel="section"><i class="menu-item-icon fa fa-fw fa-sign-language"></i><br>抓到我</a><ul class="submenu submenu-抓到我"><li class="submenu-item submenu-item-github"><a href="https://github.com/EGo14T" rel="section" target="_blank">GitHub</a></li><li class="submenu-item submenu-item-twitter"><a href="https://twitter.com/E_Go1ST" rel="section" target="_blank">Twitter</a></li><li class="submenu-item submenu-item-知乎"><a href="https://www.zhihu.com/people/ego1st-82/activities" rel="section" target="_blank">知乎</a></li></ul></li><li class="menu-item scaleup menu-item-实验室"><a href="javascript:;" rel="section"><i class="menu-item-icon fa fa-fw fa-flask"></i><br>实验室</a></li><li class="menu-item scaleup menu-item-归档"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item scaleup menu-item-留言板"><a href="/message/" rel="section"><i class="menu-item-icon fa fa-fw fa-pencil"></i><br>留言板</a></li><li class="menu-item search"><form class="search-form"><input name="keyword" type="text" class="search-input" placeholder="站内搜索"> <button type="submit" class="search-submit"><i class="fa fa-search"></i></button></form></li></ul></nav><div class="site-brand-wrapper" style="background-image:url(https://cdn.ego1st.cn/themeImg/header-weather.jpg)"><div class="site-meta"><div class="custom-logo-site-title"><div class="brand"><span class="logo-line-before"><i></i></span><div class="site-title"><div id="animate" class="animate"><span>H</span><span>i</span><span>,</span><span>E</span><span>G</span><span>o</span><span>1</span><span>S</span><span>T</span><span>!</span></div><div id="guide" class="guide"><span>H</span><span>i</span><span>,</span><span>E</span><span>G</span><span>o</span><span>1</span><span>S</span><span>T</span><span>!</span></div></div><span class="logo-line-after"><i></i></span></div></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><div class="site-master" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-master-avatar" itemprop="image" src="https://cdn.ego1st.cn/themeImg/EGo1ST.jpg" alt=""></div></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-date"><div class="post-month">08月</div><div class="post-day">13</div></div><div class="post-badge"><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">技术教程</span></a></span></div><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ego1st.cn/TravisCIYourBlog/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content=""><meta itemprop="description" content=""><meta itemprop="image" content="https://cdn.ego1st.cn/themeImg/EGo1ST.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hi,EGo1ST!"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">持续化部署你的blog</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-13T15:36:06+00:00">2019-08-13</time> </span><span class="post-wordcount"><span class="post-meta-divider">•</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计</span> <span title="字数统计">1737</span> </span><span id="/TravisCIYourBlog/" class="leancloud_visitors" data-flag-title="持续化部署你的blog"><span class="post-meta-divider">•</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">被</span> <span class="leancloud-visitors-count"></span> <span class="post-meta-item-text">人看爆</span></span></div></header><div class="post-body" itemprop="articleBody"><p>上一周把自己的博客搬到新买的腾讯云上了，为了节省部署的时间，所以我的博客使用了持续化部署，其中踩了许多坑，写个教程总结记录一下。</p><span id="more"></span><p>大概的过程：</p><ol><li><p>首先在你的服务器上安装Git，搭建Git服务器，并使用免密登陆SSH</p></li><li><p>在服务器上创建仓库用来存放TravisCI生成的博客静态文件</p></li><li><p>把你的博客项目放在GitHub上，其中博客静态文件放在主分支（master）上，其他文件（博客项目）放在其他分支上（本文为hexo分支）</p></li><li><p>配置TravisCI，监听你的hexo分支，即你写完博客，push到GitHub上，TravisCI监听到hexo分支发生改变，自动帮你构建博客静态文件</p></li><li><p>TravisCI帮你构建完静态文件后，通过git命令把博客静态文件push到博客仓库主分支上和你的服务器Git仓库中</p></li><li><p>配置服务器Git仓库钩子（GitHooks），使服务器仓库发现有push到仓库的动作后，自动把仓库中的静态文件部署到网站根目录</p></li></ol><h1 id="在VPS上搭建Git服务端"><a href="#在VPS上搭建Git服务端" class="headerlink" title="在VPS上搭建Git服务端"></a>在VPS上搭建Git服务端</h1><p>默认使用的操作系统为Centos7</p><h2 id="安装Git服务"><a href="#安装Git服务" class="headerlink" title="安装Git服务"></a>安装Git服务</h2><p>首先查看yum源仓库的Git信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum info git</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_16-33-13.jpg"></p><p>版本是1.8.3.1，想使用最新版的Git，只能使用编译安装</p><h3 id="下载Git："><a href="#下载Git：" class="headerlink" title="下载Git："></a>下载Git：</h3><p>Git<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1HEz1isggSfyDXnfrITBSTA" title="With a Title">下载地址</a>. 提取码: ugu2</p><h3 id="在Centos7中安装依赖库"><a href="#在Centos7中安装依赖库" class="headerlink" title="在Centos7中安装依赖库"></a>在Centos7中安装依赖库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install gcc perl-ExtUtils-MakeMaker</span></span><br></pre></td></tr></table></figure><h3 id="卸载低版本Git"><a href="#卸载低版本Git" class="headerlink" title="卸载低版本Git"></a>卸载低版本Git</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove git</span><br></pre></td></tr></table></figure><h3 id="解压编译安装Git"><a href="#解压编译安装Git" class="headerlink" title="解压编译安装Git"></a>解压编译安装Git</h3><p>移动到存放Git源码的目录，我的在<code>/usr/local/git</code>git目录自己创建</p><p>解压编译安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf git-2.22.0.tar.gz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> git-2.22.0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make prefix=/usr/<span class="built_in">local</span>/git all</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make prefix=/usr/<span class="built_in">local</span>/git install</span></span><br></pre></td></tr></table></figure><p>添加到环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/profile</span></span><br><span class="line"><span class="meta">#</span><span class="bash">在末尾添加</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/git/bin:<span class="variable">$PATH</span>&quot;</span></span></span><br></pre></td></tr></table></figure><p>保存退出，使配置立即生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git --version  <span class="comment">#查看版本号</span></span></span><br></pre></td></tr></table></figure><p>将git设置为默认路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/git/bin/git-upload-pack /usr/bin/git-upload-pack</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/git/bin/git-receive-pack /usr/bin/git-receive-pack</span> </span><br></pre></td></tr></table></figure><p>创建一个git用户组和用户，用来运行git服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> groupadd git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> useradd git -g git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> passwd git <span class="comment">#参数是用户名</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su git  <span class="comment">#切换git用户</span></span></span><br></pre></td></tr></table></figure><h2 id="在服务器上搭建Git仓库"><a href="#在服务器上搭建Git仓库" class="headerlink" title="在服务器上搭建Git仓库"></a>在服务器上搭建Git仓库</h2><h3 id="创建仓库目录"><a href="#创建仓库目录" class="headerlink" title="创建仓库目录"></a>创建仓库目录</h3><p>我的仓库目录在<code>/srv/gitrepo</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /srv/gitrepo <span class="comment"># gitrepo目录自己创建</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git init blog.git --bare <span class="comment"># 创建仓库目录</span></span></span><br></pre></td></tr></table></figure><p>至此，一个服务器Git仓库就搭建好了，还没实现免密登陆，后面会讲到</p><h1 id="使用TravisCI持续化部署"><a href="#使用TravisCI持续化部署" class="headerlink" title="使用TravisCI持续化部署"></a>使用TravisCI持续化部署</h1><h2 id="配置TravisCI"><a href="#配置TravisCI" class="headerlink" title="配置TravisCI"></a>配置TravisCI</h2><h3 id="使用Github账号登陆TravisCI"><a href="#使用Github账号登陆TravisCI" class="headerlink" title="使用Github账号登陆TravisCI"></a>使用Github账号登陆TravisCI</h3><p><a href="%5Bhttps://travis-ci.org%5D">TravisCi</a>,注意网站地址结尾是org（公开的），com结尾的是私有的，是收费的</p><h3 id="添加你的仓库"><a href="#添加你的仓库" class="headerlink" title="添加你的仓库"></a>添加你的仓库</h3><p><img src="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-19-07.jpg"></p><h3 id="配置你的仓库"><a href="#配置你的仓库" class="headerlink" title="配置你的仓库"></a>配置你的仓库</h3><p>点击<code>Setting</code> ，设置选项<br><img src="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-22-28.jpg"></p><h3 id="在Github添加Access-Token"><a href="#在Github添加Access-Token" class="headerlink" title="在Github添加Access Token"></a>在Github添加Access Token</h3><p><code>Setting</code>–&gt;<code>Developer setting</code>–&gt;<code>Personal access tokens</code>–&gt;<code>Generate new token</code><br><img src="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-27-04.jpg">除了删库，其他的都打上勾</p><h3 id="在TravisCI设置中添加token"><a href="#在TravisCI设置中添加token" class="headerlink" title="在TravisCI设置中添加token"></a>在TravisCI设置中添加token</h3><p><img src="https://cdn.ego1st.cn/postImg/Snipaste_2019-08-14_17-31-40.jpg"></p><p><code>name</code>自定义 ，<code>value</code>为Github上的<code>access Token</code>点击Add添加</p><h3 id="在你的本地博客目录下添加-travis-yml"><a href="#在你的本地博客目录下添加-travis-yml" class="headerlink" title="在你的本地博客目录下添加.travis.yml"></a>在你的本地博客目录下添加<code>.travis.yml</code></h3><p>具体配置如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span> <span class="string">lts/*</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">hexo</span> <span class="string">g</span></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">cd</span> <span class="string">./public</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">init</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">user.name</span> <span class="string">&quot;&quot;</span> <span class="comment"># 你的Git名字</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">user.email</span> <span class="string">&quot;&quot;</span> <span class="comment"># 你的Git邮箱</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">&quot;Update docs with TRAVIS-CI&quot;</span> <span class="comment"># conmmit信息</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">--force</span> <span class="string">--quiet</span> <span class="string">&quot;https://$&#123;myblog&#125;@$&#123;GH_REF&#125;&quot;</span> <span class="string">master:master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="comment"># 监听hexo分支变化，具体把源文件提交到分支，请左转度娘</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">GH_REF:</span> <span class="string">github.com/EGo14T/ego14t.github.io.git</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">yarn:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">directories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line"><span class="attr">after_success:</span></span><br><span class="line"><span class="attr">addons:</span></span><br><span class="line">  <span class="attr">ssh_known_hosts:</span> <span class="comment"># 给Travis服务器添加你的VPS ip地址，以跳过询问</span></span><br></pre></td></tr></table></figure><p>到这一步你已经可以自动部署你的博客到Github Pages了</p><h2 id="Travis免密登陆你的VPS"><a href="#Travis免密登陆你的VPS" class="headerlink" title="Travis免密登陆你的VPS"></a>Travis免密登陆你的VPS</h2><h3 id="生成SSH密钥对"><a href="#生成SSH密钥对" class="headerlink" title="生成SSH密钥对"></a>生成SSH密钥对</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 随便生成在哪都行，文件名也随意</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -f travis.key</span></span><br></pre></td></tr></table></figure><p>把生成的公钥文件<code>e.g. travis.key.pub</code> 内容添加到VPS上的<code>~/.ssh/authorized_keys</code>中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi ~/.ssh/authorized_keys <span class="comment">#把公钥添加进去</span></span></span><br></pre></td></tr></table></figure><h3 id="使用Travis-CI-加密工具加密私钥"><a href="#使用Travis-CI-加密工具加密私钥" class="headerlink" title="使用Travis CI 加密工具加密私钥"></a>使用Travis CI 加密工具加密私钥</h3><p>这个步骤必须在Linux下执行！！！</p><p>这个步骤必须在Linux下执行！！！</p><p>这个步骤必须在Linux下执行！！！ 重要的事情说三遍</p><h4 id="安装加密工具"><a href="#安装加密工具" class="headerlink" title="安装加密工具"></a>安装加密工具</h4><p>首先你要安装Ruby，具体安装，自己百度</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装加密工具</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo gem install travis</span>	</span><br></pre></td></tr></table></figure><h4 id="通过命令行登录-Travis-并加密文件："><a href="#通过命令行登录-Travis-并加密文件：" class="headerlink" title="通过命令行登录 Travis 并加密文件："></a>通过命令行登录 Travis 并加密文件：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 交互式操作，使用 GitHub 账号密码登录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> travis login --auto</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加密完成后会在当前目录下生成一个 travis.key.enc 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 会在你的 .travis.yml 文件里自动加上用于解密的 shell 语句</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 会自动格式化你的 .travis.yml 文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> travis encrypt-file travis.key -add</span></span><br></pre></td></tr></table></figure><p>以上步骤建议在你的博客项目根目录进行</p><p>把你的博客项目push到刚才创建的VPS Git仓库中</p><p>为了能免密登陆自己的VPS服务器，把刚才的私钥也拷贝一份放到<code>C:\Users\用户名\.ssh</code>目录下，然后push项目</p><p>然后在本地把加密操作后的项目从VPS Git仓库中clone下来</p><h2 id="使用GitHooks自动部署你的静态文件"><a href="#使用GitHooks自动部署你的静态文件" class="headerlink" title="使用GitHooks自动部署你的静态文件"></a>使用GitHooks自动部署你的静态文件</h2><p>首先要在<code>.travis.yml</code>文件中追加push到你的VPS Git仓库的命令</p><p>通过SSH的方式push</p><h3 id="配置GitHooks"><a href="#配置GitHooks" class="headerlink" title="配置GitHooks"></a>配置GitHooks</h3><p>在你的VPS Git仓库中找到hooks目录，在里面创建<code>post-receive</code>文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /srv/gitrepo/myblog.git/hooks</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim post-receive <span class="comment"># 创建钩子文件</span></span></span><br></pre></td></tr></table></figure><p>文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">unset GIT_DIR</span><br><span class="line">path=/www/wwwroot/myblog/ #你的网站根目录，也是个git仓库，把你的项目从仓库中clone到这个地方</span><br><span class="line">cd $path</span><br><span class="line">git fetch --all</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure><p>以上操作是在git用户下执行的</p><p>给脚本增加运行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br></pre></td></tr></table></figure><p>创建完之后，运行一下看看有没有异常</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./post-receive</span></span><br></pre></td></tr></table></figure><p>如果出现异常，请查看一下，网站根目录是否输入git用户，具体就是权限的问题</p><ol><li>必须保证git用户的根目录的文件夹权限为 755</li><li>必须保证git用户的根目录下的.ssh文件夹权限为 700</li><li>必须保证git用户的根目录下的.ssh文件夹中的authorized_keys文件的权限为 600</li></ol><h2 id="大功告成！！！"><a href="#大功告成！！！" class="headerlink" title="大功告成！！！"></a>大功告成！！！</h2><p>此时，你就可以写好博客然后push到Git仓库，TravisCI检测到你的分支发生变动，自动帮你执行<code>hexo g -d</code>的操作，然后把生成的文件提交Git仓库的master分支上，供Github Pages使用，还会提交一份到你的VPS Git仓库中，你的VPS Git仓库检测到有push行为，会触发Git Hooks，然后执行部署操作</p><p>有些地方描述的可能有些模糊，还请多去百度~~</p></div><div class="post-share">分享到：</div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/SpringCloud-BuildEureka/" rel="next" title="SpringCloud之eureka的搭建"><i class="fa fa-chevron-left"></i> SpringCloud之eureka的搭建</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/SpringBootHotDeploy/" rel="prev" title="SpringBoot配置热部署">SpringBoot配置热部署 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><div id="dsqjs"><section class="dsqjs-info"><p id="dsqjs-load-disqus" class="dsqjs-message">评论完整模式加载中...如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理</p></section></div></div></div><script type="text/javascript">window.DISQUS=null,new DisqusJS({shortname:"ego1st",siteName:"Hi,EGo1ST!",identifier:"TravisCIYourBlog/",url:"https://ego1st.cn/TravisCIYourBlog/",api:"",apikey:"",admin:"",adminLabel:""})</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://cdn.ego1st.cn/themeImg/card.jpg" alt=""><p class="site-author-name" itemprop="name"><span style="opacity:.2">帅B</span>EGo1ST</p><p class="site-description motion-element" itemprop="description">什么都不会，什么都敢做的全干工程师</p></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/EGo14T" target="_blank" title="GitHub" data-balloon="GitHub" data-balloon-pos="up"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/E_Go1ST" target="_blank" title="Twitter" data-balloon="Twitter" data-balloon-pos="up"><i class="fa fa-fw fa-twitter"></i></a></span></div><div class="feed-link motion-element"><a class="feed-rss" href="/atom.xml" rel="alternate" target="_blank"><i class="fa fa-rss"></i> <span>RSS 订阅</span></a></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">32</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div></nav><div class="cc-license motion-element" itemprop="license"><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" class="cc-opacity" target="_blank"><img src="https://www.laobuluo.com/banner/upyun.png" alt="Creative Commons"></a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%A8VPS%E4%B8%8A%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">1.</span> <span class="nav-text">在VPS上搭建Git服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Git%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.1.</span> <span class="nav-text">安装Git服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDGit%EF%BC%9A"><span class="nav-number">1.1.1.</span> <span class="nav-text">下载Git：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8Centos7%E4%B8%AD%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="nav-number">1.1.2.</span> <span class="nav-text">在Centos7中安装依赖库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD%E4%BD%8E%E7%89%88%E6%9C%ACGit"><span class="nav-number">1.1.3.</span> <span class="nav-text">卸载低版本Git</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%8E%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Git"><span class="nav-number">1.1.4.</span> <span class="nav-text">解压编译安装Git</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BAGit%E4%BB%93%E5%BA%93"><span class="nav-number">1.2.</span> <span class="nav-text">在服务器上搭建Git仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">创建仓库目录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8TravisCI%E6%8C%81%E7%BB%AD%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-number">2.</span> <span class="nav-text">使用TravisCI持续化部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AETravisCI"><span class="nav-number">2.1.</span> <span class="nav-text">配置TravisCI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Github%E8%B4%A6%E5%8F%B7%E7%99%BB%E9%99%86TravisCI"><span class="nav-number">2.1.1.</span> <span class="nav-text">使用Github账号登陆TravisCI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BD%A0%E7%9A%84%E4%BB%93%E5%BA%93"><span class="nav-number">2.1.2.</span> <span class="nav-text">添加你的仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BD%A0%E7%9A%84%E4%BB%93%E5%BA%93"><span class="nav-number">2.1.3.</span> <span class="nav-text">配置你的仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8Github%E6%B7%BB%E5%8A%A0Access-Token"><span class="nav-number">2.1.4.</span> <span class="nav-text">在Github添加Access Token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8TravisCI%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%B7%BB%E5%8A%A0token"><span class="nav-number">2.1.5.</span> <span class="nav-text">在TravisCI设置中添加token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E4%BD%A0%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%8D%9A%E5%AE%A2%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%B7%BB%E5%8A%A0-travis-yml"><span class="nav-number">2.1.6.</span> <span class="nav-text">在你的本地博客目录下添加.travis.yml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Travis%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E4%BD%A0%E7%9A%84VPS"><span class="nav-number">2.2.</span> <span class="nav-text">Travis免密登陆你的VPS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90SSH%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="nav-number">2.2.1.</span> <span class="nav-text">生成SSH密钥对</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Travis-CI-%E5%8A%A0%E5%AF%86%E5%B7%A5%E5%85%B7%E5%8A%A0%E5%AF%86%E7%A7%81%E9%92%A5"><span class="nav-number">2.2.2.</span> <span class="nav-text">使用Travis CI 加密工具加密私钥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%8A%A0%E5%AF%86%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">安装加密工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%99%BB%E5%BD%95-Travis-%E5%B9%B6%E5%8A%A0%E5%AF%86%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">通过命令行登录 Travis 并加密文件：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8GitHooks%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E4%BD%A0%E7%9A%84%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="nav-number">2.3.</span> <span class="nav-text">使用GitHooks自动部署你的静态文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEGitHooks"><span class="nav-number">2.3.1.</span> <span class="nav-text">配置GitHooks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E5%8A%9F%E5%91%8A%E6%88%90%EF%BC%81%EF%BC%81%EF%BC%81"><span class="nav-number">2.4.</span> <span class="nav-text">大功告成！！！</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-image"></div><div class="footer-inner"><p>博客已萌萌哒运行<span id="since"></span><span class="my-face">(●'◡'●)ﾉ♥</span></p><p>© <span itemprop="copyrightYear">2021</span> Hi,EGo1ST!. 由 <a class="a-footer" href="https://hexo.io/" target="_blank" class="external" rel="nofollow">Hexo</a> 强力驱动. Theme By <a class="a-footer" href="https://github.com/DIYgod/hexo-theme-sagiri" target="_blank" class="external" rel="nofollow">Sagiri</a> v21.04.26. <a class="a-footer" href="/sitemap.xml" target="_blank">站点地图</a>. <span>豫ICP备19029669号.</span></p><p>Made with <i class="fa fa-heart throb" style="color:#d43f57"></i> by <span class="author" itemprop="copyrightHolder">EGo1ST</span>.</p></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><canvas id="evanyou"></canvas></div><script type="text/javascript" src="/js/sagiri.min.js?v=21.04.26"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")})</script><script src="https://cdn.ego1st.cn/JS/ribbon.js"></script></body></html>